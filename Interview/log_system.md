# 日志系统

## 解决问题
- 收集用户行为
- 特定用户非crash反馈

## 采集信息
- 帧率
- 内存
- 电量

## 存在的问题
- 要保证程序的流畅性
- 保证日志内容的完整性和容错性

## 优秀的日志模块

- 安全性 ： 不能把用户的隐私信息打印到日志文件里，不能把日志明文打到日志文件里。
- 流畅性 ： 不能影响程序的性能。最基本的保证是使用了日志不会导致程序卡顿。
- 完整性 ： 不能因为程序被系统杀掉，或者发生了 crash，crash 捕捉模块没有捕捉到导致部分时间点没有日志， 要保证程序整个生命周期内都有日志。
- 容错性 ： 不能因为部分数据损坏就影响了整个日志文件，应该最小化数据损坏对日志文件的影响。

以上要求之间的矛盾
- 如果直接写文件会卡顿，但如果使用内存做中间 buffer 又可能丢日志
- 如果不对日志内容进行压缩会导致 IO 卡顿影响性能，但如果压缩，部分损坏可能会影响整个压缩块，而且为了增大压缩率集中压缩又可能导致 CPU 短时间飙高。


## 上传时机

### 主动上传
- 用户反馈
- 监控指标异常

### 被动上传
- 